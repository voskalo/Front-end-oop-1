<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieMatch - My Collection</title>
    <style>
        :root {
            --bg-dark: #121218;
            --panel-bg: #241e38;
            --accent-pink: #b83b88;
            --text-main: #ffffff;
            --text-sec: #a0a0b0;
            --danger: #ff4757;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
        body { background-color:var(--bg-dark); color:var(--text-main); min-height:100vh; display:flex; flex-direction:column; }

        nav {
            background-color:#0a0a0e; padding:15px 40px;
            display:flex; justify-content:space-between; align-items:center;
            border-bottom:1px solid #333; position:sticky; top:0; z-index:100;
        }
        .logo a { text-decoration:none; color:white; font-weight:bold; font-size:1.2rem; }
        .nav-links { display:flex; gap:30px; font-size:0.9rem; }
        .nav-links a { text-decoration:none; color:var(--text-sec); transition:0.3s; }
        .nav-links a:hover, .nav-links a.active { color:var(--text-main); }
        .user-menu { display:flex; align-items:center; gap:15px; }
        .avatar { width:35px; height:35px; background-color:var(--accent-pink); border-radius:50%; }

        .container { max-width:1200px; margin:0 auto; padding:40px 20px; width:100%; }
        .page-header {
            margin-bottom:30px; display:flex; justify-content:space-between;
            align-items:end; border-bottom:1px solid #333; padding-bottom:20px;
        }
        .page-title h1 { font-size:2.5rem; margin-bottom:5px; }
        .page-subtitle { color:var(--text-sec); }

        .movies-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:30px; }
        .movie-card {
            background-color:var(--panel-bg); border-radius:12px; overflow:hidden;
            transition:transform 0.3s, box-shadow 0.3s; position:relative;
        }
        .movie-card:hover { transform:translateY(-8px); box-shadow:0 10px 20px rgba(0,0,0,0.5); }
        .movie-poster {
            height:300px; width:100%; background-color:#333;
            display:flex; justify-content:center; align-items:center; position:relative; overflow:hidden;
        }
        .movie-poster img { width:100%; height:100%; object-fit:cover; }
        .remove-btn {
            position:absolute; top:10px; right:10px; background-color:rgba(0,0,0,0.7);
            color:var(--danger); border:none; width:30px; height:30px; border-radius:50%;
            cursor:pointer; display:flex; align-items:center; justify-content:center;
            opacity:0; transition:0.3s; font-size:1.2rem; font-weight:bold; z-index:2;
        }
        .movie-card:hover .remove-btn { opacity:1; }
        .movie-info { padding:15px; }
        .movie-title { font-weight:600; font-size:1rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

        .empty-msg { color:var(--text-sec); grid-column:1/-1; text-align:center; padding:60px 0; font-size:1.1rem; }
        .empty-msg a { color:var(--accent-pink); text-decoration:none; }
    </style>
</head>
<body>
    <nav>
        <div class="logo"><a href="index.html">MovieMatch</a></div>
        <div class="nav-links">
            <a href="index.html">Popular</a>
            <a href="index.html#about">About</a>
            <a href="index.html#contacts">Contacts</a>
            <a href="profile.html">Friends</a>
            <a href="my_films.html" class="active" style="color:var(--accent-pink);">My Collection</a>
        </div>
        <div class="user-menu">
            <span id="nav-username"></span>
            <div class="avatar"></div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <div class="page-title">
                <h1>My Liked Movies</h1>
                <div class="page-subtitle" id="subtitle">Loading...</div>
            </div>
        </div>
        <div class="movies-grid" id="grid"></div>
    </div>

    <script>
        const BASE_URL = 'http://127.0.0.1:8000';

        async function init() {
            const token  = localStorage.getItem('token');
            const userId = localStorage.getItem('userId');

            // Якщо немає токена — редирект на логін
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            // Показуємо ім'я в навігації
            const username = localStorage.getItem('username');
            if (username) document.getElementById('nav-username').textContent = username;

            try {
                // GET /movies/{userId}/liked — вподобані фільми поточного юзера
                const resp = await fetch(`${BASE_URL}/movies/${userId}/liked`);

                if (!resp.ok) {
                    document.getElementById('subtitle').textContent = 'Failed to load movies.';
                    return;
                }

                const movies = await resp.json();
                renderMovies(movies);

            } catch (e) {
                window.location.href = 'p_error.html';
            }
        }

        function renderMovies(movies) {
            const grid = document.getElementById('grid');
            const subtitle = document.getElementById('subtitle');

            subtitle.textContent = `You have ${movies.length} movie${movies.length !== 1 ? 's' : ''} in your collection!`;

            if (!movies.length) {
                grid.innerHTML = `
                    <div class="empty-msg">
                        No movies yet.<br>
                        Go to <a href="choose.html">Choose</a> to add some!
                    </div>`;
                return;
            }

            grid.innerHTML = movies.map(m => {
                const posterUrl = m.poster_path
                    ? `https://image.tmdb.org/t/p/w500${m.poster_path}`
                    : '';
                return `
                <div class="movie-card" id="card-${m.id}">
                    <div class="movie-poster">
                        <button class="remove-btn" onclick="removeCard(${m.id})">&times;</button>
                        ${posterUrl
                            ? `<img src="${posterUrl}" alt="${m.movie_name}" onerror="this.style.display='none'">`
                            : `<span style="color:#aaa; padding:10px; text-align:center;">${m.movie_name}</span>`
                        }
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${m.movie_name}</div>
                    </div>
                </div>`;
            }).join('');
        }

        function removeCard(movieId) {
            // Видаляємо картку візуально (анімація)
            // Якщо хочеш також видаляти з бази — потрібен окремий DELETE ендпоінт на беку
            const card = document.getElementById(`card-${movieId}`);
            card.style.transition = '0.3s';
            card.style.transform  = 'scale(0.8)';
            card.style.opacity    = '0';
            setTimeout(() => {
                card.remove();
                // Оновлюємо лічильник
                const remaining = document.querySelectorAll('.movie-card').length;
                document.getElementById('subtitle').textContent =
                    `You have ${remaining} movie${remaining !== 1 ? 's' : ''} in your collection!`;
            }, 300);
        }

        init();
    </script>
</body>
</html>
